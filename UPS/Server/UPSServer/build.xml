<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="Ant build for UPS Server Project" basedir="." default="">

    <!-- Properties -->
    <property name="webapp" value="upsserver2"/>
    <property name="path" value="/upsserver2"/>
    <property name="url" value="http://geobot1.ethz.ch:8080/manager"/>
    <property name="username" value="admin"/>
    <property name="password" value="geoBot"/>

    <property name="dist" value="dist"/>
    <property name="ldap" value="${dist}/ldap"/>
    <property name="tomcat" value="${dist}/tomcat"/>
    <property name="storage" value="${dist}/storage"/>
    <property name="client" value="${dist}/client"/>
    <property name="LKAStubSource" value="LKAClient/src/stub"/>
    <property name="ClientStubSource" value="UPSServerClient/src/stub"/>
    <!--property name="WSDLURL" value="http://zo-bi-webtst1.ethz.ch:8080/soaplkanmeldung/services/LKA?WSDL"/-->
    <property name="LKAWSDLURL" value="https://soap.bi.id.ethz.ch/lka/v-1-0/services/v-1-0?WSDL"/>
    <property name="ClientWSDLURL" value="http://geobot1.ethz.ch:8080/upsserver2/UPSWebService2.jws?wsdl"/>


    <!-- Tomcat Tasks -->
    <taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask">
        <classpath refid="deployer.classpath"/>
    </taskdef>

    <taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask">
        <classpath refid="deployer.classpath"/>
    </taskdef>

    <!-- Library path -->
    <path id="deployer.classpath">
        <fileset dir="config/build-system/jakarta-tomcat-5.0.19-deployer/lib">
            <include name="*.jar"/>
        </fileset>
    </path>

    <taskdef name="wsdl2java" classname="org.apache.axis.tools.ant.wsdl.Wsdl2javaAntTask">
        <classpath refid="axis"/>
    </taskdef>

    <taskdef name="java2wsdl" classname="org.apache.axis.tools.ant.wsdl.Java2WsdlAntTask">
        <classpath refid="axis"/>
    </taskdef>

    <path id="servlet-api">
        <fileset dir="lib/servlet-api">
            <include name="*.jar"/>
        </fileset>
    </path>


    <path id="axis">
        <fileset dir="lib/axis">
            <include name="*.jar"/>
        </fileset>
    </path>

    <path id="log4j">
        <fileset dir="lib/log4j">
            <include name="*.jar"/>
        </fileset>
    </path>

    <path id="xmatrix">
        <fileset id="xmatrix" dir="lib/xmatrix">
            <include name="*.jar"/>
        </fileset>
    </path>


    <target name="generateLKAStub">
        <mkdir dir="${LKAStubSource}"/>
        <java classname="org.apache.axis.wsdl.WSDL2Java" dir="${LKAStubSource}" classpathref="axis" fork="true">
            <arg value="${LKAWSDLURL}"/>
        </java>
    </target>


    <target name="test">
        <!--
        <java classname="org.apache.axis.utils.Admin" dir="UPSServerWebApp/src/web/WEB-INF" fork="true">
            <classpath>
                <path refid="axis"/>
                <path location="target/IDEA/UPSServer/classes"/>
            </classpath>
            <arg value="server"/>
            <arg value="deploy.wsdd"/>
        </java>
        -->
        <java2wsdl output="target/arash.wsdl"
                   location="http://localhost:8080/axis/service/RankingService"
                   namespace="service"
                   classname="com.wegmueller.ups.webservice.StandardUPSWebService">
            <mapping namespace="ups" package="com.wegmueller.ups"/>
            <classpath>
                <pathelement location="target\IDEA\exploded\WEB-INF\classes"/>
            </classpath>

        </java2wsdl>

    </target>

    <target name="generateClientStub">
        <mkdir dir="${ClientStubSource}"/>
        <java classname="org.apache.axis.wsdl.WSDL2Java" dir="${ClientStubSource}" classpathref="axis" fork="true">
            <arg value="${ClientWSDLURL}"/>
        </java>
    </target>

    <target name="ldap">
        <mkdir dir="${ldap}"/>

        <javac srcdir="LDAPAuthenticator/src/java" destdir="${ldap}">
            <classpath>
                <path refid="log4j"/>
            </classpath>
        </javac>
        <jar basedir="${ldap}" destfile="${dist}/ldap.jar"/>
        <delete dir="${ldap}"/>
    </target>

    <target name="storage">
        <mkdir dir="${storage}"/>
        <javac srcdir="UPSStorage/src/java" destdir="${storage}">
            <classpath>
                <path refid="log4j"/>
            </classpath>
        </javac>
        <jar basedir="${storage}" destfile="${dist}/storage.jar"/>
        <delete dir="${storage}"/>
    </target>

    <target name="upsclient">
        <mkdir dir="${client}"/>
        <javac srcdir="UPSServerClient/src/java" destdir="${client}">
            <classpath>
                <fileset dir="lib/axis">
                    <include name="*.jar"/>
                </fileset>
                <fileset dir="lib/log4j">
                    <include name="*.jar"/>
                </fileset>
            </classpath>
        </javac>

        <unjar dest="${client}">
            <fileset dir="lib/axis">
                <include name="*.jar"/>
            </fileset>
            <fileset dir="lib/log4j">
                <include name="*.jar"/>
            </fileset>
        </unjar>
        <jar basedir="${client}" destfile="${dist}/upsclient.jar">
            <manifest>
                <attribute name="main-class" value="com.wegmueller.ups.webservice.UPSServerClientExample"/>
            </manifest>
        </jar>
        <delete dir="${client}"/>
    </target>


    <target name="TestUPSClient">
        <java jar="${dist}/upsclient.jar" fork="true">
            <arg value="dfrey"/>
            <arg value="leni1234"/>
        </java>
    </target>

    <!-- Tomcat Tasks-->
    <target name="deploy" description="Deploy web application">
        <deploy url="${url}" username="${username}" password="${password}"
                path="${path}" war="target/IDEA/WAR/${webapp}.war" update="true"/>
    </target>


    <target name="reload" description="Reload web application">
        <reload url="${url}" username="${username}" password="${password}"
                path="${path}"/>
    </target>

</project>